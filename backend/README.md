# GraphQL Starter

### â˜‘ TO improve

- [ ] Refactor schemas and resolvers in relevant API folder
- [ ] **[HARD]** Write **Lazy Mongoose/GraphQL aggregation/population with projection** -> Boost performance
- [ ] Update _tsconfig_, _package.json_, _eslint.js_, _launch.json_
- [ ] Add **Jest** or **Mocka** for testing
- [ ] Finish Husky setup

### Difference from REST:

- One **POST** endpoint
- _Query_ â†’ **GET**
- _Mutation_ â†’ **POST**, **PUT**, **DELETE**
- _Subscriptin_ â†’ **Socket**

## GraphQL vs Rest

## âœ… GraphQL Pros:

- No over/under fetching
- Playground (autogenerated)
- Don't have a version mapping (api.example.com/v1 or /v2)
- It's a type system (cathches erros, self documenting, tooling(react hooks...))

## âŒ GraphQL Cons:

- More complex to fetch data efficiently (dataloader, prisma/hasura/appsync) (Mongo population)
- Harder to cache and rate limit (CDN, Redis - not big difference)
- Request monitoring (Allways one enpoint) - Prometheus can still be used here

## ğŸ›  Tech Stack

### âš›ï¸ React

- **Next.js** for SSR (webpack compiling automaticly, babel config, SEO)
- `getInitalProps` - fetch data on the server (life ciclyes method)
- **StyledComponent** (?) - good for CSS
- **React-Apollo** - for interfacing with Apollo Client
  _Appolo Client replaces the need for redux + data fetching/cashing libaries_
- Apollo Dev Tools (Chrome / Mozzila extension)

### ğŸ“ˆ Graph QL

- Deskotp APP: [GraphQL Playground](https://www.electronjs.org/apps/graphql-playground)
- **Apollo Express Server** or **GraphGL-Express** (lighweight)
  - Performing GraphQL Mutations
  - Fetching GraphQL Queries
  - Cashing GraphQL Data
  - Manging Local Storage
  - Error and Loading UI States

### ğŸ’¹ Node.js

- **Apollo Express Server** or **GraphGL-Express** (lighweight)
- **TypeScript**
- Test: **Jest/Mocka**
- GitHooks: **Husky**
- DB **MongoDB** - **mongoose**
  - _Mongo Compass_
  - _Studio 3T_
  - _Mongo Atlas_ (web)

### ğŸ¶ Husky

Install
`npm i -D husky`

Uninstall
`npm uninstall husky`

```json
 "husky": {
    "hooks": {
      "pre-commit": "npm test",
      "pre-push": "npm test",
  }
}
```

- [ ] Check commit message - define commit message form `BTH-\d{3}:\((feat|bug|fix)\)-.+` `e.g. BTH-123:(feat)- first commit`
- [ ] Run prettier
- [ ] Run linter
- [x] Run test

### ğŸ§ª Test

- [Apollo Documentation](https://www.apollographql.com/docs/apollo-server/testing/mocking/)
- [GraphQL Documentation](https://graphql.org/blog/mocking-with-graphql/)

---

### Stuf that I don't thing is a good choice for us

#### â§‹ Prisma with Mongo ?? (not recommend) - It's generate a lot of useless stuff ğŸ¤”

- Hard to setup and use
- Primsa 2 is on the way (in beta)
- Provides a set of GraphQL CRUD APIs for MongoDB (or other DBs)
- Schemas Definitions
- Data Relationships(not relavant for Mongo ) [CHECK]
- Self-hosted or as-a-service

#### GraaphQL Yoga ? Build on Apollo and Express ğŸ˜•

- An Express GraphQL Server For:
- Implementing Query and Mutation Resolvers
- Custom Server Side Logic
- Performance is bad and they are have issues (maybe sometime they will be good choice )

---

# ğŸ“½ Project Arhitecture

## ğŸ¤” Worth mention

- [Code-first](https://dev.to/novvum/graphql-code-first-and-sdl-first-the-current-landscape-in-mid-2019-547h) vs Schema-first approach
- Scalars, Fragments, ENUM, Union, Interfaces

## ğŸŒ² Structure of files in a project

```
### Backend
â”œâ”€ ğŸ“ .vscode           [optional]
|   â”œâ”€ ğŸ“œ settings.json [optional]
|   â”œâ”€ ğŸ“œ tasks.json [optional]
|   â””â”€ ğŸ“œ launch.json   [optional]
|
â”œâ”€ ğŸ“ node_modules (auto-generate)
â”œâ”€ ğŸ“ build
|
â”œâ”€ ğŸ“ server
|   â”œâ”€ ğŸ“ api
|   |   â”œâ”€ ğŸ“ user
|   |   |   â”œâ”€ ğŸ“œ index.ts
|   |   |   â”œâ”€ ğŸ“œ user.schema.ts
|   |   |   â”œâ”€ ğŸ“œ user.model.ts
|   |   |   â”œâ”€ ğŸ“œ user.controller.ts
|   |   |   â””â”€ ğŸ“œ user.service.ts
|   |   â””â”€â”€ ...
|   |
|   â”œâ”€ ğŸ“œ server.ts
|   |
|   â”œâ”€ ğŸ“ graphql
|   |   â”œâ”€ ğŸ“ schemas
|   |   â””â”€ ğŸ“ resolvers
|   |
|   â””â”€â”€ğŸ“ services
|       â”œâ”€ ğŸ“œ logger.ts
|       â”œâ”€ ğŸ“œ dbconfig.ts
|       â”œâ”€ ğŸ“œ middleware.ts
|       â””â”€ ğŸ“œ [mostly singleton modules, services, mailer, varibales]
|
|
â”œâ”€ ğŸ“œ .eslintrc.json / .eslintrc.ts
â”œâ”€ ğŸ“œ .package.json
â”œâ”€ ğŸ“œ .package-lock.json (auto-generate)
â”œâ”€ ğŸ“œ .gitignore
â”œâ”€ ğŸ“œ .env (.staging.env && .production.env)
â”œâ”€ ğŸ“œ tsconfig.json
â”œâ”€ ğŸ“œ Procfile (for Heroku only)
â””â”€ ğŸ“œ README.md
```

![GraphQL Cheat Sheet](https://raw.githubusercontent.com/sogko/graphql-shorthand-notation-cheat-sheet/master/graphql-shorthand-notation-cheat-sheet.png)
