# GraphQL Starter

### ☑ TO improve

- [ ] Refactor schemas and resolvers in relevant API folder
- [ ] **[HARD]** Write **Lazy Mongoose/GraphQL aggregation/population with projection** -> Boost performance
- [ ] Update _tsconfig_, _package.json_, _eslint.js_, _launch.json_
- [ ] Add **Jest** or **Mocka** for testing
- [ ] Finish Husky setup

### Difference from REST:

- One **POST** endpoint
- _Query_ → **GET**
- _Mutation_ → **POST**, **PUT**, **DELETE**
- _Subscriptin_ → **Socket**

## GraphQL vs Rest

## ✅ GraphQL Pros:

[READ](https://medium.com/@myylow/6-reasons-why-its-time-to-switch-to-graphql-from-rest-34e6c43924d0)

- No over/under fetching
- Playground (autogenerated)
- Don't have a version mapping (api.example.com/v1 or /v2)
- It's a type system (cathches erros, self documenting, tooling(react hooks...))

## ❌ GraphQL Cons:

- More complex to fetch data efficiently (dataloader, prisma/hasura/appsync) (Mongo population)
- Harder to cache and rate limit (CDN, Redis - not big difference)
- Request monitoring (Allways one enpoint) - Prometheus can still be used here

## 🛠 Tech Stack

### ⚛️ React

- **Next.js** for SSR (webpack compiling automaticly, babel config, SEO)
- `getInitalProps` - fetch data on the server (life ciclyes method)
- **StyledComponent** (?) - good for CSS
- **React-Apollo** - for interfacing with Apollo Client
  _Appolo Client replaces the need for redux + data fetching/cashing libaries_
- Apollo Dev Tools (Chrome / Mozzila extension)

### 📈 Graph QL

- Deskotp APP: [GraphQL Playground](https://www.electronjs.org/apps/graphql-playground)
- **Apollo Express Server** or **GraphGL-Express** (lighweight)
  - Performing GraphQL Mutations
  - Fetching GraphQL Queries
  - Cashing GraphQL Data
  - Manging Local Storage
  - Error and Loading UI States

### 💹 Node.js

- **Apollo Express Server** or **GraphGL-Express** (lighweight)
- **TypeScript**
- Test: **Jest/Mocka**
- GitHooks: **Husky**

### 📦 Database

## **MongoDB** - **mongoose**

- _Mongo Compass_
- _Studio 3T_
- _Mongo Atlas_ (web)

## MongoDB VS DynamoDB

[comparison](https://db-engines.com/en/system/Amazon+DynamoDB%3BMongoDB)

### 🐶 Husky

Install
`npm i -D husky`

Uninstall
`npm uninstall husky`

```json
 "husky": {
    "hooks": {
      "pre-commit": "npm test",
      "pre-push": "npm test",
  }
}
```

- [ ] Check commit message - define commit message form `BTH-\d{3}:\((feat|bug|fix)\)-.+` `e.g. BTH-123:(feat)- first commit`
- [ ] Run prettier
- [ ] Run linter
- [x] Run test

### 🧪 Test _(unit)_

- [Apollo Test Documentation](https://www.apollographql.com/docs/apollo-server/testing/mocking/)
- [GraphQL Test Documentation](https://graphql.org/blog/mocking-with-graphql/)

### 🔒 Security

- [Appollo security documentation](https://www.apollographql.com/docs/apollo-server/security/authentication/)

### Stuf that I don't thing is a good choice for us

#### ⧋ Prisma with Mongo ?? (not recommend) - It's generate a lot of useless stuff 🤔

- Hard to setup and use
- Primsa 2 is on the way (in beta)
- Provides a set of GraphQL CRUD APIs for MongoDB (or other DBs)
- Schemas Definitions
- Data Relationships(not relavant for Mongo ) [CHECK]
- Self-hosted or as-a-service

#### GraaphQL Yoga ? Build on Apollo and Express 😕

- An Express GraphQL Server For:
- Implementing Query and Mutation Resolvers
- Custom Server Side Logic
- Performance is bad and they are have issues (maybe sometime they will be good choice )

---

# 📽 Project Arhitecture

## 🤔 Worth mention

- [Code-first](https://dev.to/novvum/graphql-code-first-and-sdl-first-the-current-landscape-in-mid-2019-547h) vs Schema-first approach
- Scalars, Fragments, ENUM, Union, Interfaces

- [Autogenerate types](https://medium.com/atheros/generate-javascript-static-types-from-graphql-typescript-and-flow-4d28b46b8d13)

## Microservice

- **Playground** vs Postman vs Swagger
- Unit test (**jest**/mocka)
- Monolith? **NO...**
- Do we need microservice architecture as in BOU1?
- [Microservice](https://itnext.io/graphql-in-a-microservices-architecture-d17922b886eb)
- [Apollo Microservice Solution](https://principledgraphql.com/operations#10-separate-the-graphql-layer-from-the-service-layer)
- [Serverless](https://serverless.com/blog/make-serverless-graphql-api-using-lambda-dynamodb/)

## 🌲 Structure of files in a project

```
### Backend
├─ 📁 .vscode           [optional]
|   ├─ 📜 settings.json [optional]
|   ├─ 📜 tasks.json [optional]
|   └─ 📜 launch.json   [optional]
|
├─ 📁 node_modules (auto-generate)
├─ 📁 build
|
├─ 📁 server
|   ├─ 📁 api
|   |   ├─ 📁 user
|   |   |   ├─ 📜 index.ts
|   |   |   ├─ 📜 user.schema.ts
|   |   |   ├─ 📜 user.model.ts
|   |   |   ├─ 📜 user.resolvers.ts
|   |   |   ├─ 📜 user.controller.ts
|   |   |   └─ 📜 user.service.ts
|   |   └── ...
|   |
|   ├─ 📜 server.ts
|   |
|   |
|   └──📁 services
|       ├─ 📜 logger.ts
|       ├─ 📜 dbconfig.ts
|       ├─ 📜 middleware.ts
|       └─ 📜 [mostly singleton modules, services, mailer, varibales]
|
|
├─ 📜 .eslintrc.json / .eslintrc.ts
├─ 📜 .package.json
├─ 📜 .package-lock.json (auto-generate)
├─ 📜 .gitignore
├─ 📜 .env (.staging.env && .production.env)
├─ 📜 tsconfig.json
├─ 📜 Procfile (for Heroku only)
├─ 📜 ... # configuration files
└─ 📜 README.md
```

My Questions?

- Improve **typings**. We have
  1. mongoose schema
  2. TypeScript interfaces (Document Mongoose Interface) 3. GraphQL Schema
- **Selection/Projection** - Boost performance by fetching only data that you need from DB
- Mongo **Agregation** - Boost performance by aggregation - one query
- Tests... see if somehow graphql will influence on tests(not unit)
- do we need feature/steps files?

![GraphQL Cheat Sheet](https://raw.githubusercontent.com/sogko/graphql-shorthand-notation-cheat-sheet/master/graphql-shorthand-notation-cheat-sheet.png)
